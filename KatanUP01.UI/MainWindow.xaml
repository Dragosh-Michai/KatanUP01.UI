<Window x:Class="KatanUP01.UI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:KatanUP01.UI"
        mc:Ignorable="d"
        Title="Управляющая компания - Заявки на ремонт" 
        Height="600" Width="900"
        WindowStartupLocation="CenterScreen"
        Icon="Resources/icon.ico">

    <Window.Resources>
        <!-- Стиль кнопок -->
        <Style x:Key="AccentButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#67BA80"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>

        <!-- Стиль заголовков -->
        <Style x:Key="HeaderStyle" TargetType="TextBlock">
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="20"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="#333333"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
        </Style>

        <!-- Стиль для статусов -->
        <Style x:Key="StatusStyle" TargetType="TextBlock">
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="Normal"/>
            <Style.Triggers>
                <Trigger Property="Text" Value="Открыта">
                    <Setter Property="Foreground" Value="Red"/>
                    <Setter Property="FontWeight" Value="Bold"/>
                </Trigger>
                <Trigger Property="Text" Value="В работе">
                    <Setter Property="Foreground" Value="Orange"/>
                    <Setter Property="FontWeight" Value="Bold"/>
                </Trigger>
                <Trigger Property="Text" Value="Закрыта">
                    <Setter Property="Foreground" Value="Green"/>
                    <Setter Property="FontWeight" Value="Bold"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid Background="#F4E8D3">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Шапка с логотипом -->
        <Border Grid.Row="0" Background="White" Padding="10">
            <StackPanel Orientation="Horizontal">
                <!-- Логотип -->
                <Image Source="Resources/logo.png" Width="50" Height="50" Margin="0,0,10,0"/>
                <StackPanel>
                    <TextBlock Text="Управляющая компания" Style="{StaticResource HeaderStyle}"/>
                    <TextBlock Text="Система управления заявками на ремонт" 
                               FontFamily="Segoe UI" 
                               FontSize="14" 
                               Foreground="#666666"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- Основной контент -->
        <Grid Grid.Row="1" Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Панель управления -->
            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                <Button x:Name="btnAdd" Content="➕ Добавить заявку" 
                        Style="{StaticResource AccentButtonStyle}" 
                        Click="BtnAdd_Click"/>
                <Button x:Name="btnEdit" Content="✏️ Редактировать" 
                        Style="{StaticResource AccentButtonStyle}" 
                        Click="BtnEdit_Click"/>
                <Button x:Name="btnDelete" Content="🗑️ Удалить" 
                        Style="{StaticResource AccentButtonStyle}" 
                        Click="BtnDelete_Click"/>
                <Button x:Name="btnHistory" Content="📋 История заявок" 
                        Style="{StaticResource AccentButtonStyle}" 
                        Click="BtnHistory_Click"/>
                <Button x:Name="btnRefresh" Content="🔄 Обновить" 
                        Style="{StaticResource AccentButtonStyle}" 
                        Click="BtnRefresh_Click"/>
            </StackPanel>

            <!-- Список заявок -->
            <DataGrid x:Name="dgRequests" 
                      Grid.Row="1" 
                      AutoGenerateColumns="False" 
                      CanUserAddRows="False" 
                      SelectionMode="Single"
                      Background="White"
                      BorderBrush="#CCCCCC"
                      BorderThickness="1"
                      RowBackground="#FFFFFF"
                      AlternatingRowBackground="#F9F9F9"
                      FontFamily="Segoe UI"
                      FontSize="12"
                      RowDetailsVisibilityMode="VisibleWhenSelected"
                      SelectionUnit="FullRow"
                      MouseDoubleClick="DgRequests_MouseDoubleClick">
                <DataGrid.Columns>
                    <!-- ID -->
                    <DataGridTextColumn Header="ID" Width="50" 
                                        Binding="{Binding RequestId}" 
                                        IsReadOnly="True"/>

                    <!-- Адрес (с проверкой на null) -->
                    <DataGridTextColumn Header="Адрес" Width="200">
                        <DataGridTextColumn.Binding>
                            <Binding Path="Addresses.FullAddress">
                                <Binding.FallbackValue>Не указан</Binding.FallbackValue>
                            </Binding>
                        </DataGridTextColumn.Binding>
                    </DataGridTextColumn>

                    <!-- Заявитель -->
                    <DataGridTextColumn Header="Заявитель" Width="150" 
                                        Binding="{Binding ApplicantName}"/>

                    <!-- Телефон -->
                    <DataGridTextColumn Header="Телефон" Width="120" 
                                        Binding="{Binding ApplicantPhone}"/>

                    <!-- Описание проблемы -->
                    <DataGridTextColumn Header="Описание" Width="250" 
                                        Binding="{Binding ProblemDescription}"/>

                    <!-- Исполнитель (с проверкой на null) -->
                    <DataGridTextColumn Header="Исполнитель" Width="150">
                        <DataGridTextColumn.Binding>
                            <Binding Path="Employees.LastName">
                                <Binding.FallbackValue>Не назначен</Binding.FallbackValue>
                            </Binding>
                        </DataGridTextColumn.Binding>
                    </DataGridTextColumn>

                    <!-- Статус со стилем -->
                    <DataGridTextColumn Header="Статус" Width="100" 
                                        Binding="{Binding Status}">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock" BasedOn="{StaticResource StatusStyle}"/>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <!-- Дата создания -->
                    <DataGridTextColumn Header="Дата создания" Width="120">
                        <DataGridTextColumn.Binding>
                            <Binding Path="CreatedDate" StringFormat="dd.MM.yyyy HH:mm"/>
                        </DataGridTextColumn.Binding>
                    </DataGridTextColumn>
                </DataGrid.Columns>

                <!-- Детали строки (опционально) -->
                <DataGrid.RowDetailsTemplate>
                    <DataTemplate>
                        <Border BorderBrush="#67BA80" BorderThickness="1" Padding="10" Margin="5">
                            <StackPanel>
                                <TextBlock Text="{Binding ProblemDescription}" 
                                           FontFamily="Segoe UI" 
                                           FontSize="12" 
                                           TextWrapping="Wrap"
                                           Margin="0,0,0,5"/>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Дата создания: " FontWeight="Bold"/>
                                    <TextBlock Text="{Binding CreatedDate, StringFormat=dd.MM.yyyy HH:mm}"/>
                                    <TextBlock Text="   |   " Margin="10,0"/>
                                    <TextBlock Text="ID адреса: " FontWeight="Bold"/>
                                    <TextBlock Text="{Binding AddressId}"/>
                                    <TextBlock Text="   |   " Margin="10,0"/>
                                    <TextBlock Text="ID исполнителя: " FontWeight="Bold"/>
                                    <TextBlock Text="{Binding EmployeeId}"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </DataGrid.RowDetailsTemplate>
            </DataGrid>
        </Grid>

        <!-- Статус бар -->
        <StatusBar Grid.Row="2" Background="White">
            <StatusBarItem>
                <TextBlock x:Name="tbStatus" Text="Готово" FontFamily="Segoe UI"/>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <TextBlock x:Name="tbRecordCount" Text="Записей: 0" Margin="10,0" FontFamily="Segoe UI"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>